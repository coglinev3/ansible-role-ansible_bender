---
# file: roles/ansible-bender/handlers/main.yml

- name: Sysctl_ping
  become: true
  ansible.builtin.command: sysctl -p /etc/sysctl.d/60-ping_group_range.conf
  changed_when: false

- name: Sysctl_max_user_namespace
  become: true
  ansible.builtin.command: sysctl -p /etc/sysctl.d/60-user_namespaces.conf
  changed_when: false

- name: Sysctl_user_namespace
  become: true
  ansible.builtin.service:
    name: procps
    state: restarted

- name: "Alpine: Get all files from repository cache."
  ansible.builtin.find:
    paths: /var/cache/apk
    patterns: "*"
  register: files_to_delete
  listen: remove apk_cache

- name: "Alpine: Remove repository cache."
  become: "{{ ab_become }}"
  ansible.builtin.file:
    path: "{{ item.path }}"
    state: absent
  loop: "{{ files_to_delete.files }}"
  loop_control:
    label: "{{ item.path }}"
  listen: remove apk_cache
